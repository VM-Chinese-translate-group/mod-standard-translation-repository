name: Packer
on:
  push:
    paths:
      - 'projects/**'

jobs:
  pack:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Create temp directory
        run: mkdir -p temp

      - name: Zip each project folder separately
        run: |
          for dir in projects/*; do
            [ -d "$dir" ] || continue
            version=$(basename "$dir")
            safe_name=$(echo "$version" | sed 's/+/plus/g')
            zip -r "temp/${safe_name}.zip" "$dir"
          done

      - name: Upload each artifact separately
        run: |
          for zipfile in temp/*.zip; do
            base=$(basename "$zipfile" .zip)
            artifact_name="VM汉化组模组汉化包${base}"
            echo "Uploading $zipfile as $artifact_name"
            gh run upload-artifact "$artifact_name" "$zipfile"
          done
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Clean up
        run: rm -rf temp
